
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Fields: Data Buffers &#8212; Pisces-Geometry  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'reference/fields/buffers';</script>
    <link rel="icon" href="../../_static/pm_favicon.svg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fields: Field Components" href="components.html" />
    <link rel="prev" title="Fields: NumPy Compatibility" href="numpy.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Pisces-Geometry  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting_started.html">
    Quick-start Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../auto_examples/index.html">
    Example Gallery
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    PyMetric User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting_started.html">
    Quick-start Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../auto_examples/index.html">
    Example Gallery
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    PyMetric User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../theory/coordinate_theory.html">Curvilinear Coordinate Systems</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../coordinates/overview.html">Coordinate Systems: General Info</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../grids/overview.html">Geometric Grids: General Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grids/build_custom_grids.html">Geometric Grids: Custom Grid Classes</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Fields: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="numpy.html">Fields: NumPy Compatibility</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Fields: Data Buffers</a></li>
<li class="toctree-l1"><a class="reference internal" href="components.html">Fields: Field Components</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../differential_geometry/overview.html">Differential Geometry: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../differential_geometry/dependence.html">Symbolic Tensor Dependence API</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../coordinates/dev.html">Coordinate Systems: Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grids/dev.html">Geometric Grids: Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Fields: Developers</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">PyMetric User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Fields: Data Buffers</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="fields-data-buffers">
<span id="buffers"></span><h1>Fields: Data Buffers<a class="headerlink" href="#fields-data-buffers" title="Link to this heading">#</a></h1>
<p>The Pisces Geometry <strong>buffer system</strong> provides an abstraction layer over data storage backends
for field components. It allows field operations to remain agnostic to whether data is stored in memory
(via <a class="reference external" href="https://numpy.org/doc/stable/index.html">NumPy</a>), with units
(via <a class="reference external" href="https://unyt.readthedocs.io/en/stable/">unyt</a>), or on disk (e.g., HDF5). This enables modular,
extensible, and backend-agnostic scientific computing.</p>
<p>This document provides an overview of the buffer architecture, key classes, resolution mechanisms, and subclassing guidelines.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id2">Overview</a></p></li>
<li><p><a class="reference internal" href="#creating-buffers-of-different-types" id="id3">Creating Buffers of Different Types</a></p>
<ul>
<li><p><a class="reference internal" href="#resolving-buffer-classes" id="id4">Resolving Buffer Classes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#operations-on-buffers" id="id5">Operations on Buffers</a></p>
<ul>
<li><p><a class="reference internal" href="#indexing-and-slicing-behavior" id="id6">Indexing and Slicing Behavior</a></p></li>
<li><p><a class="reference internal" href="#representation-types-and-views" id="id7">Representation Types and Views</a></p></li>
<li><p><a class="reference internal" href="#numpy-semantics-universal-functions" id="id8">Numpy Semantics: Universal Functions</a></p></li>
<li><p><a class="reference internal" href="#numpy-semantics-numpy-functions" id="id9">Numpy Semantics: NumPy Functions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#buffer-unit-management" id="id10">Buffer Unit Management</a></p>
<ul>
<li><p><a class="reference internal" href="#unit-conversion-in-place" id="id11">Unit Conversion (In-place)</a></p></li>
<li><p><a class="reference internal" href="#unit-casting-copy" id="id12">Unit Casting (Copy)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#subclassing-a-custom-buffer" id="id13">Subclassing a Custom Buffer</a></p></li>
<li><p><a class="reference internal" href="#see-also" id="id14">See Also</a></p></li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>Buffers are the low-level storage abstraction in the <a class="reference internal" href="../../_as_gen/fields.html#module-fields" title="fields"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fields</span></code></a> module. They are responsible for:</p>
<ul class="simple">
<li><p>Managing actual data (values and memory layout)</p></li>
<li><p>Interfacing with array backends (e.g., NumPy, <cite>unyt</cite>, HDF5)</p></li>
<li><p>Supporting broadcasting, NumPy semantics, and I/O</p></li>
<li><p>Providing a clean interface for the <a class="reference internal" href="../../_as_gen/fields.components.FieldComponent.html#fields.components.FieldComponent" title="fields.components.FieldComponent"><code class="xref py py-class docutils literal notranslate"><span class="pre">FieldComponent</span></code></a> system</p></li>
</ul>
<p>Each buffer class inherits from <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.html#fields.buffers.base.BufferBase" title="fields.buffers.base.BufferBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferBase</span></code></a>, which provides a uniform API across backends.</p>
</section>
<section id="creating-buffers-of-different-types">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Creating Buffers of Different Types</a><a class="headerlink" href="#creating-buffers-of-different-types" title="Link to this heading">#</a></h2>
<p>There are currently <strong>three core buffer types</strong>:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.core.ArrayBuffer.html#fields.buffers.core.ArrayBuffer" title="fields.buffers.core.ArrayBuffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArrayBuffer</span></code></a> — an in-memory buffer for plain <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a>.</p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.core.UnytArrayBuffer.html#fields.buffers.core.UnytArrayBuffer" title="fields.buffers.core.UnytArrayBuffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnytArrayBuffer</span></code></a> — an in-memory buffer for <a class="reference external" href="https://unyt.readthedocs.io/en/latest/modules/unyt.array.html#unyt.array.unyt_array" title="(in unyt v3.0.1.post30+gcb71e02)"><code class="xref py py-class docutils literal notranslate"><span class="pre">unyt_array</span></code></a> objects with physical units.</p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.core.HDF5Buffer.html#fields.buffers.core.HDF5Buffer" title="fields.buffers.core.HDF5Buffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">HDF5Buffer</span></code></a> — a persistent, disk-backed buffer based on <a class="reference external" href="https://docs.h5py.org/en/latest/high/dataset.html#h5py.Dataset" title="(in h5py v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">h5py.Dataset</span></code></a>.</p></li>
</ul>
<p>Buffers can be created in multiple ways, depending on the format of your input data and your desired backend. The most
generic of these approaches is the <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.from_array.html#fields.buffers.base.BufferBase.from_array" title="fields.buffers.base.BufferBase.from_array"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_array()</span></code></a>. This tries to coerce an input object
(<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a>, <a class="reference external" href="https://unyt.readthedocs.io/en/latest/modules/unyt.array.html#unyt.array.unyt_array" title="(in unyt v3.0.1.post30+gcb71e02)"><code class="xref py py-class docutils literal notranslate"><span class="pre">unyt_array</span></code></a>, etc.) into a compatible buffer type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pymetric.fields.buffers</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnytArrayBuffer</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="n">buf</span> <span class="o">=</span> <span class="n">UnytArrayBuffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;keV&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This approach has the distinct advantage of clarifying the buffer that will be returned at the expense
of requiring that the user knows that their data is compatible with the particular buffer class.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>In addition to <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.from_array.html#fields.buffers.base.BufferBase.from_array" title="fields.buffers.base.BufferBase.from_array"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_array()</span></code></a>, there are
also <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.zeros.html#fields.buffers.base.BufferBase.zeros" title="fields.buffers.base.BufferBase.zeros"><code class="xref py py-meth docutils literal notranslate"><span class="pre">zeros()</span></code></a>, <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.ones.html#fields.buffers.base.BufferBase.ones" title="fields.buffers.base.BufferBase.ones"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ones()</span></code></a>,
<a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.full.html#fields.buffers.base.BufferBase.full" title="fields.buffers.base.BufferBase.full"><code class="xref py py-meth docutils literal notranslate"><span class="pre">full()</span></code></a>,
and <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.empty.html#fields.buffers.base.BufferBase.empty" title="fields.buffers.base.BufferBase.empty"><code class="xref py py-meth docutils literal notranslate"><span class="pre">empty()</span></code></a> attached to each buffer class.</p>
</div>
<section id="resolving-buffer-classes">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Resolving Buffer Classes</a><a class="headerlink" href="#resolving-buffer-classes" title="Link to this heading">#</a></h3>
<p>In some cases, it is useful to let PyMetric decide which buffer class you need based on the type of the
object that needs to be wrapped. This procedure is called <strong>buffer resolution</strong>. At its core, resolution is
a simple procedure; each <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.html#fields.buffers.base.BufferBase" title="fields.buffers.base.BufferBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferBase</span></code></a> has three critical attributes:</p>
<ol class="arabic simple">
<li><p>The <strong>resolvable classes</strong>: the classes that buffer class can faithfully wrap around.</p></li>
<li><p>The <strong>core class</strong>: the <em>single</em> class that gets wrapped around.</p></li>
<li><p>The <strong>resolution priority</strong>: dictates at what priority a given buffer class is.</p></li>
</ol>
<p>When PyMetric is asked to resolve the correct buffer for a given object, it will seek the <em>highest</em> priority class
which can <em>faithfully</em> encapsulate the class of the object being resolved. That object is then cast to the <strong>core class</strong>
and wrapped by the buffer class. There are a number of ways to enter the buffer resolution pipeline:</p>
<ol class="arabic simple">
<li><p>Using the <a class="reference internal" href="../../_as_gen/fields.buffers.base.buffer_from_array.html#fields.buffers.base.buffer_from_array" title="fields.buffers.base.buffer_from_array"><code class="xref py py-func docutils literal notranslate"><span class="pre">buffer_from_array()</span></code></a> function.</p></li>
<li><p>Equivalently, each <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.html#fields.buffers.base.BufferBase" title="fields.buffers.base.BufferBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferBase</span></code></a> has <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.resolve.html#fields.buffers.base.BufferBase.resolve" title="fields.buffers.base.BufferBase.resolve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resolve()</span></code></a> which
is a simple alias for option 1.</p></li>
<li><p>Finally, PyMetric provides a number of utility functions in <a class="reference internal" href="../../_as_gen/fields.buffers.utilities.html#module-fields.buffers.utilities" title="fields.buffers.utilities"><code class="xref py py-mod docutils literal notranslate"><span class="pre">utilities</span></code></a> like <code class="xref py py-func docutils literal notranslate"><span class="pre">zeros()</span></code>
or <a class="reference internal" href="../../_as_gen/fields.buffers.utilities.buffer.html#fields.buffers.utilities.buffer" title="fields.buffers.utilities.buffer"><code class="xref py py-func docutils literal notranslate"><span class="pre">buffer()</span></code></a> which all enter the resolution process.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An initiated reader might ask, “how does PyMetric know what buffers are available?” In fact, this question is a critical
one if you are extending PyMetric with custom buffer classes. The answer is the use of <strong>buffer registries</strong>. Each entry point
to the buffer resolution process typically takes two kwargs:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">buffer_class=</span></code> can be used to explicitly set the buffer class to use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer_registry=</span></code> can tell PyMetric to search through a custom <a class="reference internal" href="../../_as_gen/fields.buffers.registry.BufferRegistry.html#fields.buffers.registry.BufferRegistry" title="fields.buffers.registry.BufferRegistry"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferRegistry</span></code></a> class
for the buffer.</p></li>
</ul>
<p>Custom buffer registries can be used to override the default (<code class="docutils literal notranslate"><span class="pre">__DEFAULT_BUFFER_REGISTRY__</span></code>); into which all new subclasses
are placed when then are first read by the interpreter.</p>
</div>
</section>
</section>
<section id="operations-on-buffers">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Operations on Buffers</a><a class="headerlink" href="#operations-on-buffers" title="Link to this heading">#</a></h2>
<p>At their core, buffers behave like “fancy” NumPy arrays. They can be indexed, broadcast,
operated on using NumPy functions, and manipulated using standard array-like semantics.
This allows PyMetric users to interact with buffers in a highly intuitive and flexible way
while preserving backend-specific advantages like unit tracking or disk persistence.</p>
<p>To understand buffer operations, it’s important to keep track of 3 important classes:</p>
<ul class="simple">
<li><p>The <strong>buffer class</strong>: subclass of <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.html#fields.buffers.base.BufferBase" title="fields.buffers.base.BufferBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferBase</span></code></a> representing some
dataset.</p></li>
<li><p>The <strong>core class</strong>: the class that the <strong>buffer class</strong> is actually wrapped around. This is what
the buffer sees behind the scenes.</p></li>
<li><p>The <strong>representation class(es)</strong>: the classes that are actually represented by the buffer.</p></li>
</ul>
<p>For example, the <a class="reference internal" href="../../_as_gen/fields.buffers.core.HDF5Buffer.html#fields.buffers.core.HDF5Buffer" title="fields.buffers.core.HDF5Buffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">HDF5Buffer</span></code></a> has only a single <strong>core class</strong>: <a class="reference external" href="https://docs.h5py.org/en/latest/high/dataset.html#h5py.Dataset" title="(in h5py v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">h5py.Dataset</span></code></a>,
but its <strong>representation classes</strong> are both <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> and <a class="reference external" href="https://unyt.readthedocs.io/en/latest/modules/unyt.array.html#unyt.array.unyt_array" title="(in unyt v3.0.1.post30+gcb71e02)"><code class="xref py py-class docutils literal notranslate"><span class="pre">unyt.array.unyt_array</span></code></a> depending on whether
or not the underlying dataset has units attached to it.</p>
<p>Operations on buffers hinge very specifically on the nature of these 3 classes.</p>
<section id="indexing-and-slicing-behavior">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Indexing and Slicing Behavior</a><a class="headerlink" href="#indexing-and-slicing-behavior" title="Link to this heading">#</a></h3>
<p>Indexing and slicing relies on both the <strong>core class</strong> and the <strong>representation classes</strong>. The approach is pretty simple:
the buffer will forward the indexing operation to the <strong>core class</strong> and then coerce the result into the correct <strong>representation class</strong>.</p>
<p>In most cases, the core class and the representation class are the same; but for classes like <a class="reference internal" href="../../_as_gen/fields.buffers.core.HDF5Buffer.html#fields.buffers.core.HDF5Buffer" title="fields.buffers.core.HDF5Buffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">HDF5Buffer</span></code></a>,
an indexing operation <code class="docutils literal notranslate"><span class="pre">buff[0]</span></code> will first fetch <code class="docutils literal notranslate"><span class="pre">buff.__array_object__[0]</span></code> (which indexes into the underlying HDF5 dataset) and then
wraps the result to convert it to a <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> or <a class="reference external" href="https://unyt.readthedocs.io/en/latest/modules/unyt.array.html#unyt.array.unyt_quantity" title="(in unyt v3.0.1.post30+gcb71e02)"><code class="xref py py-class docutils literal notranslate"><span class="pre">unyt_quantity</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">buf</span> <span class="o">=</span> <span class="n">UnytArrayBuffer</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;keV&quot;</span><span class="p">)</span>
<span class="n">sub</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">unyt</span><span class="o">.</span><span class="n">unyt_array</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">sub</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>If units are present (as in <code class="xref py py-class docutils literal notranslate"><span class="pre">UnytArrayBuffer</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">HDF5Buffer</span></code>), they are preserved in the sliced result unless dimensionality collapses to a scalar, in which case a <code class="xref py py-class docutils literal notranslate"><span class="pre">unyt_quantity</span></code> is returned.</p>
</section>
<section id="representation-types-and-views">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Representation Types and Views</a><a class="headerlink" href="#representation-types-and-views" title="Link to this heading">#</a></h3>
<p>Buffers offer several methods to extract the internal array in various formats:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.as_core.html#fields.buffers.base.BufferBase.as_core" title="fields.buffers.base.BufferBase.as_core"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_core()</span></code></a> returns the raw array as stored by
the backend (e.g., <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <a class="reference external" href="https://unyt.readthedocs.io/en/latest/modules/unyt.array.html#unyt.array.unyt_array" title="(in unyt v3.0.1.post30+gcb71e02)"><code class="xref py py-class docutils literal notranslate"><span class="pre">unyt_array</span></code></a>, or <a class="reference external" href="https://docs.h5py.org/en/latest/high/dataset.html#h5py.Dataset" title="(in h5py v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">h5py.Dataset</span></code></a>).</p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.as_array.html#fields.buffers.base.BufferBase.as_array" title="fields.buffers.base.BufferBase.as_array"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_array()</span></code></a> returns a standard NumPy array (units stripped if needed).</p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.as_unyt_array.html#fields.buffers.base.BufferBase.as_unyt_array" title="fields.buffers.base.BufferBase.as_unyt_array"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_unyt_array()</span></code></a> returns a unit-tagged array (if available).</p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.as_repr.html#fields.buffers.base.BufferBase.as_repr" title="fields.buffers.base.BufferBase.as_repr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_repr()</span></code></a> is a general-purpose method that returns the
buffer’s preferred array representation (unyt if possible, raw NumPy otherwise).</p></li>
</ul>
<p>These allow flexible interop in numerical code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>         <span class="c1"># always NumPy</span>
<span class="n">tagged</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">as_unyt_array</span><span class="p">()</span> <span class="c1"># only works if units are defined</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">as_repr</span><span class="p">()</span>         <span class="c1"># representation-aware fallback</span>
</pre></div>
</div>
</section>
<section id="numpy-semantics-universal-functions">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Numpy Semantics: Universal Functions</a><a class="headerlink" href="#numpy-semantics-universal-functions" title="Link to this heading">#</a></h3>
<p>Universal functions (ufuncs) are core to NumPy’s performance and expressiveness.
Examples include <code class="xref py py-func docutils literal notranslate"><span class="pre">add()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">sin()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">sqrt()</span></code>, and many others.
Buffers support full ufunc behavior through the <code class="xref py py-meth docutils literal notranslate"><span class="pre">__array_ufunc__()</span></code> protocol.</p>
<p>PyMetric’s behavior follows these principles:</p>
<ul class="simple">
<li><p>All buffer arguments are <strong>converted to their representation type</strong> via <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.as_repr.html#fields.buffers.base.BufferBase.as_repr" title="fields.buffers.base.BufferBase.as_repr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_repr()</span></code></a> before the operation.</p></li>
<li><p>The operation is performed directly on those values.</p></li>
<li><p>If an <code class="docutils literal notranslate"><span class="pre">out=</span></code> argument is specified and targets another buffer, PyMetric attempts to:
- Validate the target buffer’s compatibility.
- Avoid allocation by performing the operation <strong>in-place</strong> using the buffer’s internal storage.</p></li>
<li><p>If no <code class="docutils literal notranslate"><span class="pre">out=</span></code> argument is provided, the result is returned as an instance of the appropriate representation type (e.g., <cite>unyt_array</cite>).</p></li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pymetric.fields.buffers</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnytArrayBuffer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">unyt</span>

<span class="c1"># Create a generic unit carrying buffer and take the</span>
<span class="c1"># sqrt.</span>
<span class="n">buf</span> <span class="o">=</span> <span class="n">UnytArrayBuffer</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="c1"># ! NOT A BUFFER ANYMORE.</span>

<span class="c1"># In-place example</span>
<span class="n">out_buf</span> <span class="o">=</span> <span class="n">UnytArrayBuffer</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">unyt</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;km&quot;</span><span class="p">),</span> <span class="n">out</span><span class="o">=</span><span class="n">out_buf</span><span class="p">)</span> <span class="c1"># STILL A BUFFER.</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The TLDR of this behavior is as follows: If you use <code class="docutils literal notranslate"><span class="pre">out=</span></code>, you’ll <strong>get another buffer</strong>. Otherwise,
you’re going to get the buffer’s <strong>representation type</strong> (the type it represents).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The convention behind this behavior is that the principle priority of buffers is to be
<em>backend agnostic</em>; as such, the safest way to guarantee that behavior is to require users
to be explicit when working at the buffer level.</p>
</div>
</section>
<section id="numpy-semantics-numpy-functions">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Numpy Semantics: NumPy Functions</a><a class="headerlink" href="#numpy-semantics-numpy-functions" title="Link to this heading">#</a></h3>
<p>To provide full support for NumPy operations, most numpy functions can operate on buffers. The behavior
of this depends somewhat on semantics and on the details of different buffer types. In general, the following
principles should be understood:</p>
<ul>
<li><p>By default, a numpy function called on a buffer will strip the buffer and operation on the
<strong>representation class</strong>.</p>
<ul class="simple">
<li><p>This is true of <em>all</em> numpy functions which operate on multiple arrays in some respect or
which are not “simple” transformations. While there are some cases where this may be
a nuisance, the benefit of a standardized behavior considerably outweighs the costs.</p></li>
</ul>
</li>
<li><p>Many standard transformation methods (i.e. <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.transpose.html#numpy.transpose" title="(in NumPy v2.2)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.transpose()</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.reshape.html#numpy.reshape" title="(in NumPy v2.2)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.reshape()</span></code></a>, etc.) are implemented
as methods of the buffer class. These will (in general) return buffers as output.</p>
<ul class="simple">
<li><p>When called as a <strong>method</strong>, the buffer is transformed to its representation class,
the operation is performed on that class, and it is then passed back into <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.from_array.html#fields.buffers.base.BufferBase.from_array" title="fields.buffers.base.BufferBase.from_array"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_array()</span></code></a>.</p></li>
<li><p>When the equivalent <strong>function</strong> in numpy is called, the same operation occurs; however,
due to the nature of numpy forwarding, any relevant keyword arguments for <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.from_array.html#fields.buffers.base.BufferBase.from_array" title="fields.buffers.base.BufferBase.from_array"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_array()</span></code></a>
are lost. As such, it is generally preferable to simply use the method.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This behavior can be somewhat odd. For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">buf</span> <span class="o">=</span> <span class="n">HDF5Buffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">units</span><span class="o">=...</span><span class="p">)</span>
</pre></div>
</div>
<p>will raise an error because <code class="docutils literal notranslate"><span class="pre">units=</span></code> is not a permitted keyword argument, but</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">buf</span> <span class="o">=</span> <span class="n">HDF5Buffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">buf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">units</span><span class="o">=...</span><span class="p">)</span>
</pre></div>
</div>
<p>will work. Thus, the rule of thumb is that the <strong>method provides fine control</strong> and
the numpy function provides <strong>superficial control</strong>.</p>
</div>
</li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>For the HDF5 buffer (<a class="reference internal" href="../../_as_gen/fields.buffers.core.HDF5Buffer.html#fields.buffers.core.HDF5Buffer" title="fields.buffers.core.HDF5Buffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">HDF5Buffer</span></code></a>), <a class="reference internal" href="../../_as_gen/fields.buffers.core.HDF5Buffer.from_array.html#fields.buffers.core.HDF5Buffer.from_array" title="fields.buffers.core.HDF5Buffer.from_array"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_array()</span></code></a>
requires the user to explicitly provide <cite>file</cite> and <cite>name</cite> arguments. As such, numpy functions like <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ravel.html#numpy.ravel" title="(in NumPy v2.2)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.ravel()</span></code></a>
cannot be forwarded in the manner described above and therefore fallback to the default behavior.</p>
<p>This class <strong>does</strong> implement <code class="docutils literal notranslate"><span class="pre">inplace=</span></code> in all of its method transformations to expedite
common use cases. See, for example, <a class="reference internal" href="../../_as_gen/fields.buffers.core.HDF5Buffer.reshape.html#fields.buffers.core.HDF5Buffer.reshape" title="fields.buffers.core.HDF5Buffer.reshape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reshape()</span></code></a>.</p>
</div>
</section>
</section>
<section id="buffer-unit-management">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Buffer Unit Management</a><a class="headerlink" href="#buffer-unit-management" title="Link to this heading">#</a></h2>
<p>All buffers (and by extension fields and components) in PyMetric support <strong>units</strong> in a backend-agnostic way. A buffer may either:</p>
<ul class="simple">
<li><p>Be <em>unitless</em>, in which case its <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.units.html#fields.buffers.base.BufferBase.units" title="fields.buffers.base.BufferBase.units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">units</span></code></a> property is <code class="docutils literal notranslate"><span class="pre">None</span></code>, and its <em>representation class</em> is <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>.</p></li>
<li><p>Be <em>unit-aware</em>, in which case its <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.units.html#fields.buffers.base.BufferBase.units" title="fields.buffers.base.BufferBase.units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">units</span></code></a> property is a <a class="reference external" href="https://unyt.readthedocs.io/en/latest/modules/unyt.unit_object.html#unyt.unit_object.Unit" title="(in unyt v3.0.1.post30+gcb71e02)"><code class="xref py py-class docutils literal notranslate"><span class="pre">unyt.unit_object.Unit</span></code></a>,
and its <em>representation class</em> is <a class="reference external" href="https://unyt.readthedocs.io/en/latest/modules/unyt.array.html#unyt.array.unyt_array" title="(in unyt v3.0.1.post30+gcb71e02)"><code class="xref py py-class docutils literal notranslate"><span class="pre">unyt_array</span></code></a>.</p></li>
</ul>
<p>All of the unit management is performed via <a class="reference external" href="https://unyt.readthedocs.io/en/stable/#">Unyt</a>. There are two paradigms for
unit manipulation of buffers:</p>
<ol class="arabic simple">
<li><p>For <em>specific</em> buffer classes which support units, the units of a buffer may be changed in place via <em>conversion</em>.</p></li>
<li><p>For <em>all</em> buffer classes, the buffer can be cast to <a class="reference external" href="https://unyt.readthedocs.io/en/latest/modules/unyt.array.html#unyt.array.unyt_array" title="(in unyt v3.0.1.post30+gcb71e02)"><code class="xref py py-class docutils literal notranslate"><span class="pre">unyt_array</span></code></a>, converted, and re-wrapped into
a new buffer. We call this <em>unit casting</em>.</p></li>
</ol>
<p>For example, the units borne by the buffers in the following cases are as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pymetric</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArrayBuffer</span><span class="p">,</span> <span class="n">UnytArrayBuffer</span><span class="p">,</span> <span class="n">HDF5Buffer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">unyt</span>

<span class="c1"># As a numpy array.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">buff_x</span> <span class="o">=</span> <span class="n">ArrayBuffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># No unit support.</span>
<span class="n">unyt_buff_x</span> <span class="o">=</span> <span class="n">UnytArrayBuffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># Only unit support.</span>
<span class="n">hdf5_buff_x</span> <span class="o">=</span> <span class="n">HDF5Buffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="c1"># Both unit and no unit support.</span>
                                    <span class="s1">&#39;test.hdf5&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;tst&#39;</span><span class="p">,</span>
                                    <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">create_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">,</span><span class="n">unyt_buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">,</span><span class="n">hdf5_buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="c1"># Yields (None, dimensionless, None)</span>

<span class="c1"># As an unyt array.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">unyt</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;km&quot;</span><span class="p">)</span>
<span class="n">buff_x</span> <span class="o">=</span> <span class="n">ArrayBuffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># No unit support.</span>
<span class="n">unyt_buff_x</span> <span class="o">=</span> <span class="n">UnytArrayBuffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># Only unit support.</span>
<span class="n">hdf5_buff_x</span> <span class="o">=</span> <span class="n">HDF5Buffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="c1"># Both unit and no unit support.</span>
                                    <span class="s1">&#39;test.hdf5&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;tst&#39;</span><span class="p">,</span>
                                    <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">create_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">,</span><span class="n">unyt_buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">,</span><span class="n">hdf5_buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="c1"># Yields (None, km, km)</span>
</pre></div>
</div>
<section id="unit-conversion-in-place">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Unit Conversion (In-place)</a><a class="headerlink" href="#unit-conversion-in-place" title="Link to this heading">#</a></h3>
<p>Unit conversion is <strong>in-place</strong>, meaning the buffer is updated without copying or creating a new instance.
This is performed using:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.convert_to_units.html#fields.buffers.base.BufferBase.convert_to_units" title="fields.buffers.base.BufferBase.convert_to_units"><code class="xref py py-meth docutils literal notranslate"><span class="pre">convert_to_units()</span></code></a></p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.convert_to_base.html#fields.buffers.base.BufferBase.convert_to_base" title="fields.buffers.base.BufferBase.convert_to_base"><code class="xref py py-meth docutils literal notranslate"><span class="pre">convert_to_base()</span></code></a></p></li>
</ul>
<p>These methods are supported only by buffer types that are unit-aware (e.g., <a class="reference internal" href="../../_as_gen/fields.buffers.core.UnytArrayBuffer.html#fields.buffers.core.UnytArrayBuffer" title="fields.buffers.core.UnytArrayBuffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnytArrayBuffer</span></code></a>).
Attempting to call them on a non-unit-supporting buffer (e.g., <a class="reference internal" href="../../_as_gen/fields.buffers.core.ArrayBuffer.html#fields.buffers.core.ArrayBuffer" title="fields.buffers.core.ArrayBuffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArrayBuffer</span></code></a>) will raise an error.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pymetric</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArrayBuffer</span><span class="p">,</span> <span class="n">UnytArrayBuffer</span><span class="p">,</span> <span class="n">HDF5Buffer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">unyt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">unyt</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;km&quot;</span><span class="p">)</span>
<span class="n">buff_x</span> <span class="o">=</span> <span class="n">ArrayBuffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">unyt_buff_x</span> <span class="o">=</span> <span class="n">UnytArrayBuffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">hdf5_buff_x</span> <span class="o">=</span> <span class="n">HDF5Buffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;test.hdf5&#39;</span><span class="p">,</span><span class="s1">&#39;tst&#39;</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">create_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">unyt_buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">hdf5_buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="c1"># Result: None km km</span>

<span class="n">buff_x</span><span class="o">.</span><span class="n">convert_to_units</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="c1"># Result: ValueError: Cannot set units for buffer of class ArrayBuffer.</span>
<span class="n">unyt_buff_x</span><span class="o">.</span><span class="n">convert_to_units</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">hdf5_buff_x</span><span class="o">.</span><span class="n">convert_to_units</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">unyt_buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">hdf5_buff_x</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="c1"># Result: None m m</span>
</pre></div>
</div>
<p>Additionally, if a buffer class supports units, you may directly set the <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.units.html#fields.buffers.base.BufferBase.units" title="fields.buffers.base.BufferBase.units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">units</span></code></a> attribute, which
results in an unsafe direct setting of the units.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pymetric</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArrayBuffer</span><span class="p">,</span> <span class="n">UnytArrayBuffer</span><span class="p">,</span> <span class="n">HDF5Buffer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">unyt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">unyt</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;km&quot;</span><span class="p">)</span>
<span class="n">unyt_buff_x</span> <span class="o">=</span> <span class="n">UnytArrayBuffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">unyt_buff_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># -3.141592653589793 km</span>
<span class="n">unyt_buff_x</span><span class="o">.</span><span class="n">convert_to_units</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unyt_buff_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># -3141.592653589793 m</span>
<span class="n">unyt_buff_x</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;keV&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unyt_buff_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># -3141.592653589793 keV</span>
</pre></div>
</div>
</section>
<section id="unit-casting-copy">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Unit Casting (Copy)</a><a class="headerlink" href="#unit-casting-copy" title="Link to this heading">#</a></h3>
<p>Casting to new units always produces a <strong>new buffer</strong> (or optionally, a <cite>unyt_array</cite>).
This is the most flexible and safe option, and is supported by all buffer types.</p>
<p>Casting is performed via:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.in_units.html#fields.buffers.base.BufferBase.in_units" title="fields.buffers.base.BufferBase.in_units"><code class="xref py py-meth docutils literal notranslate"><span class="pre">in_units()</span></code></a></p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.to.html#fields.buffers.base.BufferBase.to" title="fields.buffers.base.BufferBase.to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to()</span></code></a> (alias)</p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.to_value.html#fields.buffers.base.BufferBase.to_value" title="fields.buffers.base.BufferBase.to_value"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_value()</span></code></a></p></li>
</ul>
<p>These methods perform the following:</p>
<ul class="simple">
<li><p>Convert the buffer to a <cite>unyt_array</cite></p></li>
<li><p>Apply the requested unit transformation</p></li>
<li><p>Re-wrap the array in a new buffer using resolution logic (unless <cite>as_array=True</cite>)</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pymetric</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArrayBuffer</span><span class="p">,</span> <span class="n">UnytArrayBuffer</span><span class="p">,</span> <span class="n">HDF5Buffer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">unyt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">unyt</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
<span class="n">unyt_buff_x</span> <span class="o">=</span> <span class="n">UnytArrayBuffer</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Cast to value (numpy array)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unyt_buff_x</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">))</span>
<span class="c1"># [0.   1.25 2.5  3.75 5.  ]</span>

<span class="c1"># Convert (cast) to pc with buffer</span>
<span class="c1"># resolution.</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">unyt_buff_x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;pc&#39;</span><span class="p">)))</span>
<span class="c1"># &lt;class &#39;pymetric.fields.buffers.core.UnytArrayBuffer&#39;&gt;</span>

<span class="c1"># Force the output buffer type.</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">unyt_buff_x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;pc&#39;</span><span class="p">,</span><span class="n">buffer_class</span><span class="o">=</span><span class="n">ArrayBuffer</span><span class="p">)))</span>
<span class="c1"># &lt;class &#39;pymetric.fields.buffers.core.UnytArrayBuffer&#39;&gt;</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you only need to change units temporarily or want a non-buffer output, use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s2">&quot;erg&quot;</span><span class="p">,</span> <span class="n">as_array</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="subclassing-a-custom-buffer">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Subclassing a Custom Buffer</a><a class="headerlink" href="#subclassing-a-custom-buffer" title="Link to this heading">#</a></h2>
<p>Advanced users may wish to define new buffer types (e.g., for GPU support, cloud storage,
lazy evaluation, etc.). PyMetric provides a simple but robust framework for this.</p>
<p>To create a custom buffer class, inherit from <a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.html#fields.buffers.base.BufferBase" title="fields.buffers.base.BufferBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferBase</span></code></a> and define:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__core_array_types__</span></code>: the internal storage format (e.g., <cite>torch.Tensor</cite>, <cite>xarray.DataArray</cite>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__can_resolve__</span></code>: a list of types your buffer knows how to wrap</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__resolution_priority__</span></code>: an integer priority (higher = preferred)</p></li>
</ul>
<p>You must also implement:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">array)</span></code> to wrap the storage object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from_array(cls,</span> <span class="pre">obj,</span> <span class="pre">**kwargs)</span></code> to construct your buffer from flexible input</p></li>
<li><p>Optional: <code class="docutils literal notranslate"><span class="pre">zeros()</span></code>, <code class="docutils literal notranslate"><span class="pre">ones()</span></code>, <code class="docutils literal notranslate"><span class="pre">full()</span></code>, <code class="docutils literal notranslate"><span class="pre">empty()</span></code>, and I/O methods</p></li>
<li><p>Optional: <code class="docutils literal notranslate"><span class="pre">units</span></code> property if your buffer handles units</p></li>
</ul>
<p>Example stub:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TorchBuffer</span><span class="p">(</span><span class="n">BufferBase</span><span class="p">):</span>
    <span class="n">__core_array_types__</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,)</span>
    <span class="n">__can_resolve__</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
    <span class="n">__resolution_priority__</span> <span class="o">=</span> <span class="mi">40</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_array</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
</pre></div>
</div>
<p>Once defined, your buffer will be automatically registered and resolvable by <cite>buffer_from_array()</cite>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to isolate your buffer type from PyMetric’s global resolution pipeline, register it
with a custom <a class="reference internal" href="../../_as_gen/fields.buffers.registry.BufferRegistry.html#fields.buffers.registry.BufferRegistry" title="fields.buffers.registry.BufferRegistry"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferRegistry</span></code></a> and pass it via <code class="docutils literal notranslate"><span class="pre">buffer_registry=</span></code>.</p>
</div>
</section>
<section id="see-also">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.base.BufferBase.html#fields.buffers.base.BufferBase" title="fields.buffers.base.BufferBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">BufferBase</span></code></a> — Abstract base class</p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.core.html#module-fields.buffers.core" title="fields.buffers.core"><code class="xref py py-mod docutils literal notranslate"><span class="pre">core</span></code></a> — Core buffer implementations</p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.registry.html#module-fields.buffers.registry" title="fields.buffers.registry"><code class="xref py py-mod docutils literal notranslate"><span class="pre">registry</span></code></a> — Registry system</p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.buffers.utilities.html#module-fields.buffers.utilities" title="fields.buffers.utilities"><code class="xref py py-mod docutils literal notranslate"><span class="pre">utilities</span></code></a> — Helper functions for dynamic buffer generation</p></li>
<li><p><a class="reference internal" href="../../_as_gen/fields.components.html#module-fields.components" title="fields.components"><code class="xref py py-mod docutils literal notranslate"><span class="pre">components</span></code></a> — FieldComponent framework (buffer consumers)</p></li>
</ul>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="numpy.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Fields: NumPy Compatibility</p>
      </div>
    </a>
    <a class="right-next"
       href="components.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Fields: Field Components</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-buffers-of-different-types">Creating Buffers of Different Types</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resolving-buffer-classes">Resolving Buffer Classes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#operations-on-buffers">Operations on Buffers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#indexing-and-slicing-behavior">Indexing and Slicing Behavior</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#representation-types-and-views">Representation Types and Views</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#numpy-semantics-universal-functions">Numpy Semantics: Universal Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#numpy-semantics-numpy-functions">Numpy Semantics: NumPy Functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#buffer-unit-management">Buffer Unit Management</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-conversion-in-place">Unit Conversion (In-place)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-casting-copy">Unit Casting (Copy)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#subclassing-a-custom-buffer">Subclassing a Custom Buffer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#see-also">See Also</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/reference/fields/buffers.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Eliza Diggins.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>